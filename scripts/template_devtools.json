{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "resourceEnvSuffix": {
      "defaultValue": "dev",
      "type": "String",
      "metadata": {
        "description": "Env specific suffix which will be added to each resource name"
      }
    },
    "resourceEnvSuffixWithHyphen": {
      "defaultValue": "[concat('-',parameters('resourceEnvSuffix'))]",
      "type": "String",
      "metadata": {
        "description": "Env specific suffix which will be added to each resource name"
      }
    },
    "resourceGroupName": {
      "defaultValue": "[resourceGroup().name]",
      "type": "String"
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources."
      }
    },
    "resourceLocationCode": {
      "defaultValue": "[tolower(replace(replace(resourceGroup().location,')', ''),'(',''))]",
      "type": "String",
      "metadata": {
        "description": "location/code to deploy the Azure Resources (e.g. Central US/centralus. Powershell Command: Get-AzureRmLocation |Format-Table)"
      }
    },
    "resourceLocationCodeWithHyphen": {
      "defaultValue": "[concat('-',parameters('resourceLocationCode'))]",
      "type": "String",
      "metadata": {
        "description": "location/code to deploy the Azure Resources (e.g. Central US/centralus. Powershell Command: Get-AzureRmlocation |Format-Table)"
      }
    },
    "subscriptionId": {
      "defaultValue": "[subscription().subscriptionId]",
      "type": "String"
    },
    "activeDirectoryClientId": {
      "defaultValue": "",
      "type": "String"
    },
    "activeDirectoryTenantId": {
      "defaultValue": "",
      "type": "String"
    },
    "appServicePlan_platformName": {
      "defaultValue": "[concat('approvalsplatform-secondary-', parameters('resourceEnvSuffix'))]",
      "type": "String"
    },
    "appServicePlan_webName": {
      "defaultValue": "[concat('approvals-secondary-', parameters('resourceEnvSuffix'))]",
      "type": "String"
    },
    "functionAppAuditAgentName": {
      "defaultValue": "[concat(concat('auditagent', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "appServiceSyntheticTransactionsWebsiteName": {
      "defaultValue": "[concat(concat('synthetictransactions', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "appServiceSyntheticTransactionsServiceName": {
      "defaultValue": "[concat(concat('synthetictransactionsservice', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "appServiceSupportPortalWebsiteName": {
      "defaultValue": "[concat(concat('supportportal', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "appServiceSupportPortalServicesName": {
      "defaultValue": "[concat(concat('supportportalservices', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "funcationAppPayloadReprocessingName": {
      "defaultValue": "[concat(concat('payloadreprocessing', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "functionAppTenantInfoHelperName": {
      "defaultValue": "[concat(concat('tenantinfohelper', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    },
    "functionAppTenantOnboardingHelperName": {
      "defaultValue": "[concat(concat('tenantonboardinghelper', parameters('resourceEnvSuffixWithHyphen')), parameters('resourceLocationCodeWithHyphen'))]",
      "type": "String"
    }
  },
  "variables": {},
  "resources": [
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2019-10-01",
      "name": "ApprovalsSecondaryResources",
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "resources": [
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServicePlan_webName')]",
              "location": "[parameters('location')]",
              "sku": {
                "name": "S1",
                "tier": "Standard",
                "size": "S1",
                "family": "S",
                "capacity": 1
              },
              "kind": "app",
              "properties": {
                "perSiteScaling": false,
                "targetWorkerCount": 0,
                "targetWorkerSizeId": 0
              }
            },
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServicePlan_platformName')]",
              "location": "[parameters('location')]",
              "sku": {
                "name": "S1",
                "tier": "Standard",
                "size": "S1",
                "family": "S",
                "capacity": 1
              },
              "kind": "app",
              "properties": {
                "perSiteScaling": false,
                "targetWorkerCount": 0,
                "targetWorkerSizeId": 0
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('functionAppAuditAgentName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]"
              ],
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('functionAppAuditAgentName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('functionAppAuditAgentName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": false,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 1536,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppAuditAgentName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppAuditAgentName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php"
                ],
                "netFrameworkVersion": "v6.0",
                "phpVersion": "5.6",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$ApprovalsAuditAgent",
                "scmType": "VSTSRM",
                "use32BitWorkerProcess": true,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": false
                  }
                ],
                "loadBalancing": "LeastRequests",
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "cors": {
                  "allowedOrigins": [
                    "https://functions.azure.com",
                    "https://functions-staging.azure.com",
                    "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
                },
                "localMySqlEnabled": false,
                "managedServiceIdentityId": 4222,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppAuditAgentName'), '/', parameters('functionAppAuditAgentName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppAuditAgentName'))]"
              ],
              "properties": {
                "siteName": "[parameters('functionAppAuditAgentName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServiceSyntheticTransactionsWebsiteName')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "kind": "app",
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('appServiceSyntheticTransactionsWebsiteName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('appServiceSyntheticTransactionsWebsiteName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": true,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 0,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSyntheticTransactionsWebsiteName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSyntheticTransactionsWebsiteName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php",
                  "hostingstart.html"
                ],
                "netFrameworkVersion": "v6.0",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$approvalstestharnesswebsite",
                "scmType": "None",
                "use32BitWorkerProcess": false,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": true
                  }
                ],
                "loadBalancing": "LeastRequests",
                "experiments": {
                  "rampUpRules": []
                },
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "localMySqlEnabled": false,
                "ipSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictionsUseMain": false,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.0",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSyntheticTransactionsWebsiteName'), '/', parameters('appServiceSyntheticTransactionsWebsiteName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSyntheticTransactionsWebsiteName'))]"
              ],
              "properties": {
                "siteName": "[parameters('appServiceSyntheticTransactionsWebsiteName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServiceSyntheticTransactionsServiceName')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "kind": "api",
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('appServiceSyntheticTransactionsServiceName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('appServiceSyntheticTransactionsServiceName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": true,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 0,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSyntheticTransactionsServiceName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSyntheticTransactionsServiceName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php",
                  "hostingstart.html"
                ],
                "netFrameworkVersion": "v6.0",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$approvalstestharnessapiservice",
                "scmType": "None",
                "use32BitWorkerProcess": false,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": true
                  }
                ],
                "loadBalancing": "LeastRequests",
                "experiments": {
                  "rampUpRules": []
                },
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "localMySqlEnabled": false,
                "ipSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictionsUseMain": false,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.0",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSyntheticTransactionsServiceName'), '/appsettings')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/Sites', parameters('appServiceSyntheticTransactionsServiceName'))]"
              ],
              "properties": {
                "AllowedHosts": "*",
                "BlobContainerForSchema": "testharnesspayloads",
                "BlobContainerForDataUpload": "corporatecardfeed",
                "BlobForSchema": "SyntheticTransactionSchema.json",
                "PrefixForBlobName": "TestHarnness",
                "MasterPayload": "MasterPayload.json",
                "AADInstance": "https://login.microsoftonline.com/",
                "Tenant": "microsoft.onMicrosoft.com",
                "TenantID": "[parameters('activeDirectoryTenantId')]",
                "Environment": "[tolower(parameters('location'))]",
                "Environmentlist": "DEV,TEST,UAT,PROD"
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSyntheticTransactionsServiceName'), '/', parameters('appServiceSyntheticTransactionsServiceName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSyntheticTransactionsServiceName'))]"
              ],
              "properties": {
                "siteName": "[parameters('appServiceSyntheticTransactionsServiceName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServiceSupportPortalWebsiteName')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "kind": "app",
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('appServiceSupportPortalWebsiteName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('appServiceSupportPortalWebsiteName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": true,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 0,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSupportPortalWebsiteName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSupportPortalWebsiteName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php",
                  "hostingstart.html"
                ],
                "netFrameworkVersion": "v6.0",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$approvalssupportportalwebsite",
                "scmType": "None",
                "use32BitWorkerProcess": false,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": true
                  }
                ],
                "loadBalancing": "LeastRequests",
                "experiments": {
                  "rampUpRules": []
                },
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "localMySqlEnabled": false,
                "ipSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictionsUseMain": false,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.0",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSupportPortalWebsiteName'), '/', parameters('appServiceSupportPortalWebsiteName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSupportPortalWebsiteName'))]"
              ],
              "properties": {
                "siteName": "[parameters('appServiceSupportPortalWebsiteName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('appServiceSupportPortalServicesName')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "kind": "api",
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('appServiceSupportPortalServicesName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('appServiceSupportPortalServicesName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_webName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": true,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 0,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSupportPortalServicesName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSupportPortalServicesName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php",
                  "hostingstart.html"
                ],
                "netFrameworkVersion": "v6.0",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$approvalssupportportalapiservicewebsite",
                "scmType": "None",
                "use32BitWorkerProcess": false,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": true
                  }
                ],
                "loadBalancing": "LeastRequests",
                "experiments": {
                  "rampUpRules": []
                },
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "localMySqlEnabled": false,
                "ipSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictions": [
                  {
                    "ipAddress": "Any",
                    "action": "Allow",
                    "priority": 1,
                    "name": "Allow all",
                    "description": "Allow all access"
                  }
                ],
                "scmIpSecurityRestrictionsUseMain": false,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.0",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSupportPortalServicesName'), '/appsettings')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/Sites', parameters('appServiceSupportPortalServicesName'))]"
              ],
              "properties": {
                "AllowedHosts": "*",
                "AADInstance": "https://login.microsoftonline.com/",
                "TenantID": "[parameters('activeDirectoryTenantId')]",
                "Tenant": "",
                "Environmentlist": "DEV,TEST,UAT",
                "KeyVaultClientId": "[parameters('activeDirectoryClientId')]",
                "KeyVaultSecretUri": "",
                "ApprovalSummaryTable": "ApprovalSummary"
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('appServiceSupportPortalServicesName'), '/', parameters('appServiceSupportPortalServicesName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('appServiceSupportPortalServicesName'))]"
              ],
              "properties": {
                "siteName": "[parameters('appServiceSupportPortalServicesName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('funcationAppPayloadReprocessingName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]"
              ],
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('funcationAppPayloadReprocessingName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('funcationAppPayloadReprocessingName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": false,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 1536,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('funcationAppPayloadReprocessingName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('funcationAppPayloadReprocessingName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php"
                ],
                "netFrameworkVersion": "v6.0",
                "phpVersion": "5.6",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$ApprovalsPrimaryProcessor",
                "scmType": "VSTSRM",
                "use32BitWorkerProcess": true,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": false
                  }
                ],
                "loadBalancing": "LeastRequests",
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "cors": {
                  "allowedOrigins": [
                    "https://functions.azure.com",
                    "https://functions-staging.azure.com",
                    "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
                },
                "localMySqlEnabled": false,
                "managedServiceIdentityId": 4222,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('funcationAppPayloadReprocessingName'), '/appsettings')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/Sites', parameters('funcationAppPayloadReprocessingName'))]"
              ],
              "properties": {
                "APPINSIGHTS_INSTRUMENTATIONKEY": "",
                "AZURE_CLIENT_ID": "[parameters('activeDirectoryClientId')]",
                "AZURE_CLIENT_SECRET": "",
                "AZURE_TENANT_ID": "[parameters('activeDirectoryTenantId')]",
                "AzureWebJobsStorage": "",
                "AzureWebJobsDashboard": "",
                "FUNCTIONS_EXTENSION_VERSION": "~3",
                "ValidAppIds": "",
                "WEBSITE_LOAD_CERTIFICATES": "*",
                "AppConfigurationLabel": "",
                "AzureAppConfigurationUrl": ""
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('funcationAppPayloadReprocessingName'), '/', parameters('funcationAppPayloadReprocessingName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('funcationAppPayloadReprocessingName'))]"
              ],
              "properties": {
                "siteName": "[parameters('funcationAppPayloadReprocessingName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('functionAppTenantInfoHelperName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]"
              ],
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('functionAppTenantInfoHelperName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('functionAppTenantInfoHelperName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": false,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 1536,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantInfoHelperName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppTenantInfoHelperName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php"
                ],
                "netFrameworkVersion": "v6.0",
                "phpVersion": "5.6",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$ApprovalsPrimaryProcessor",
                "scmType": "VSTSRM",
                "use32BitWorkerProcess": true,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": false
                  }
                ],
                "loadBalancing": "LeastRequests",
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "cors": {
                  "allowedOrigins": [
                    "https://functions.azure.com",
                    "https://functions-staging.azure.com",
                    "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
                },
                "localMySqlEnabled": false,
                "managedServiceIdentityId": 4222,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantInfoHelperName'), '/appsettings')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/Sites', parameters('functionAppTenantInfoHelperName'))]"
              ],
              "properties": {
                "APPINSIGHTS_INSTRUMENTATIONKEY": "",
                "AZURE_CLIENT_ID": "[parameters('activeDirectoryClientId')]",
                "AZURE_CLIENT_SECRET": "",
                "AZURE_TENANT_ID": "[parameters('activeDirectoryTenantId')]",
                "AzureWebJobsStorage": "",
                "AzureWebJobsDashboard": "",
                "FUNCTIONS_EXTENSION_VERSION": "~3",
                "StorageAccountName": "",
                "WEBSITE_LOAD_CERTIFICATES": "*"
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantInfoHelperName'), '/', parameters('functionAppTenantInfoHelperName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppTenantInfoHelperName'))]"
              ],
              "properties": {
                "siteName": "[parameters('functionAppTenantInfoHelperName')]",
                "hostNameType": "Verified"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2021-02-01",
              "name": "[parameters('functionAppTenantOnboardingHelperName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]"
              ],
              "properties": {
                "enabled": true,
                "hostNameSslStates": [
                  {
                    "name": "[concat(parameters('functionAppTenantOnboardingHelperName'), '.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Standard"
                  },
                  {
                    "name": "[concat(parameters('functionAppTenantOnboardingHelperName'), '.scm.azurewebsites.net')]",
                    "sslState": "Disabled",
                    "hostType": "Repository"
                  }
                ],
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_platformName'))]",
                "reserved": false,
                "scmSiteAlsoStopped": false,
                "clientAffinityEnabled": false,
                "clientCertEnabled": false,
                "hostNamesDisabled": false,
                "containerSize": 1536,
                "dailyMemoryTimeQuota": 0,
                "httpsOnly": true
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantOnboardingHelperName'), '/web')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppTenantOnboardingHelperName'))]"
              ],
              "properties": {
                "numberOfWorkers": 1,
                "defaultDocuments": [
                  "Default.htm",
                  "Default.html",
                  "Default.asp",
                  "index.htm",
                  "index.html",
                  "iisstart.htm",
                  "default.aspx",
                  "index.php"
                ],
                "netFrameworkVersion": "v6.0",
                "phpVersion": "5.6",
                "requestTracingEnabled": false,
                "remoteDebuggingEnabled": false,
                "httpLoggingEnabled": false,
                "acrUseManagedIdentityCreds": false,
                "logsDirectorySizeLimit": 35,
                "detailedErrorLoggingEnabled": false,
                "publishingUsername": "$ApprovalsPrimaryProcessor",
                "scmType": "VSTSRM",
                "use32BitWorkerProcess": true,
                "webSocketsEnabled": false,
                "alwaysOn": true,
                "managedPipelineMode": "Integrated",
                "virtualApplications": [
                  {
                    "virtualPath": "/",
                    "physicalPath": "site\\wwwroot",
                    "preloadEnabled": false
                  }
                ],
                "loadBalancing": "LeastRequests",
                "autoHealEnabled": false,
                "vnetRouteAllEnabled": false,
                "vnetPrivatePortsCount": 0,
                "cors": {
                  "allowedOrigins": [
                    "https://functions.azure.com",
                    "https://functions-staging.azure.com",
                    "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
                },
                "localMySqlEnabled": false,
                "managedServiceIdentityId": 4222,
                "http20Enabled": false,
                "minTlsVersion": "1.2",
                "ftpsState": "FtpsOnly",
                "preWarmedInstanceCount": 0,
                "functionAppScaleLimit": 0,
                "functionsRuntimeScaleMonitoringEnabled": false,
                "minimumElasticInstanceCount": 0,
                "azureStorageAccounts": {}
              }
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantOnboardingHelperName'), '/appsettings')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/Sites', parameters('functionAppTenantOnboardingHelperName'))]"
              ],
              "properties": {
                "APPINSIGHTS_INSTRUMENTATIONKEY": "",
                "AZURE_CLIENT_ID": "[parameters('activeDirectoryClientId')]",
                "AZURE_CLIENT_SECRET": "",
                "AZURE_TENANT_ID": "[parameters('activeDirectoryTenantId')]",
                "AzureWebJobsStorage": "",
                "AzureWebJobsDashboard": "",
                "ComponentName": "TenantOnboardingHelperProcessor",
                "FUNCTIONS_EXTENSION_VERSION": "~3",
                "StorageAccountName": "",
                "WEBSITE_LOAD_CERTIFICATES": "*"
              }
            },
            {
              "type": "Microsoft.Web/sites/hostNameBindings",
              "apiVersion": "2021-02-01",
              "name": "[concat(parameters('functionAppTenantOnboardingHelperName'), '/', parameters('functionAppTenantOnboardingHelperName'), '.azurewebsites.net')]",
              "location": "[parameters('location')]",
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppTenantOnboardingHelperName'))]"
              ],
              "properties": {
                "siteName": "[parameters('functionAppTenantOnboardingHelperName')]",
                "hostNameType": "Verified"
              }
            }
          ]
        }
      }
    }
  ]
}